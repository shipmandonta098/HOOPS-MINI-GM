<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hoops Mini GM ‚Äî Starter</title>
  <meta name="color-scheme" content="dark">
  <style>
    :root{
      --bg-0:#0d0f14;
      --bg-1:#11151b;
      --bg-2:#151a21;
      --bg-3:#1b212b;
      --text-0:#e7ecf2;
      --text-1:#b8c0cc;
      --muted:#7c8796;
      --pri:#6aa2ff;
      --pri-2:#2e6bff;
      --good:#3ac679;
      --warn:#ffb020;
      --bad:#ff6b6b;
      --border:#232b36;
      --shadow: 0 8px 24px rgba(0,0,0,.35);
      --radius:12px;
      --gap:12px;
      --gap-lg:20px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      --sans: Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:var(--sans); background:linear-gradient(180deg,var(--bg-0),var(--bg-1));
      color:var(--text-0); letter-spacing:.2px;
    }
    .app{
      display:grid; grid-template-columns:260px 1fr; grid-template-rows:56px 1fr; height:100vh;
      grid-template-areas: "sidebar topbar" "sidebar main";
    }
    header{
      grid-area:topbar; display:flex; align-items:center; gap:10px; padding:0 16px; border-bottom:1px solid var(--border);
      background:linear-gradient(180deg,var(--bg-1),var(--bg-2));
      position:sticky; top:0; z-index:5;
    }
    header .title{font-weight:700; letter-spacing:.4px}
    header .spacer{flex:1}
    header .btn{margin-left:6px}

    aside{
      grid-area:sidebar; border-right:1px solid var(--border); background:linear-gradient(180deg,var(--bg-1),var(--bg-2));
      padding:16px 12px; display:flex; flex-direction:column; gap:10px;
    }
    .brand{display:flex; align-items:center; gap:10px; padding:6px 8px; border-radius:10px}
    .brand svg{filter:drop-shadow(0 2px 8px rgba(0,0,0,.4))}
    .brand strong{font-size:15px; letter-spacing:.6px}
    nav{margin-top:6px; display:flex; flex-direction:column; gap:6px}
    .nav-btn{
      display:flex; align-items:center; gap:10px; padding:10px 12px; border-radius:10px; color:var(--text-1);
      border:1px solid transparent; background:transparent; cursor:pointer; text-align:left;
    }
    .nav-btn:hover{background:var(--bg-3); color:var(--text-0)}
    .nav-btn.active{background:var(--bg-3); color:var(--text-0); border-color:var(--border)}
    .nav-section{margin-top:auto; padding-top:12px; border-top:1px dashed var(--border);}

    main{
      grid-area:main; padding:16px; overflow:auto;
      display:flex; flex-direction:column; gap:var(--gap-lg);
    }

    .panel{
      background:linear-gradient(180deg,var(--bg-2),var(--bg-1)); border:1px solid var(--border); border-radius:var(--radius);
      box-shadow:var(--shadow); padding:16px;
    }
    .panel h2{margin:0 0 10px; font-size:18px}
    .row{display:flex; gap:var(--gap); flex-wrap:wrap}
    .col{flex:1; min-width:280px}

    .capbar{
      display:flex; align-items:center; gap:12px;
    }
    .bar{position:relative; background:#0c1118; border:1px solid var(--border); height:14px; border-radius:999px; overflow:hidden; flex:1}
    .bar .fill{height:100%; background:linear-gradient(90deg,var(--pri),var(--pri-2)); width:0%}
    .kpi{font-family:var(--mono); color:var(--text-1); font-size:12px}

    .toolbar{display:flex; gap:8px; flex-wrap:wrap; margin-bottom:8px}
    .btn{
      border:1px solid var(--border); background:var(--bg-3); color:var(--text-0); padding:8px 12px; border-radius:10px; cursor:pointer;
    }
    .btn:hover{filter:brightness(1.1)}
    .btn.good{border-color:rgba(58,198,121,.3)}
    .btn.warn{border-color:rgba(255,176,32,.3)}
    .btn.bad{border-color:rgba(255,107,107,.3)}
    .btn.ghost{background:transparent}
    .tag{display:inline-flex; align-items:center; gap:6px; padding:4px 8px; border:1px solid var(--border); border-radius:999px; color:var(--muted); font-size:12px}

    table{width:100%; border-collapse:separate; border-spacing:0; overflow:hidden; border-radius:10px; border:1px solid var(--border)}
    thead th{
      position:sticky; top:0; background:var(--bg-2); color:var(--text-1); font-weight:600; font-size:13px; padding:10px; border-bottom:1px solid var(--border); text-align:left; cursor:pointer;
    }
    tbody td{padding:10px; border-bottom:1px solid var(--border); font-size:14px}
    tbody tr:last-child td{border-bottom:none}
    tbody tr:hover{background:rgba(255,255,255,.03)}
    .num{text-align:right; font-family:var(--mono)}
    .ovr{font-weight:700}
    .pos{font-weight:600; color:var(--text-1)}
    .pill{font-family:var(--mono); font-size:12px; color:var(--text-1); background:#0c1118; padding:4px 8px; border:1px solid var(--border); border-radius:999px}

    .empty{padding:24px; color:var(--muted); text-align:center}

    /* Modal */
    .modal-backdrop{
      position:fixed; inset:0; background:rgba(0,0,0,.6); display:none; align-items:center; justify-content:center; z-index:99;
    }
    .modal{width:min(560px,92vw); background:var(--bg-2); border:1px solid var(--border); border-radius:12px; box-shadow:var(--shadow)}
    .modal header{position:unset; grid-area:unset; border-bottom:1px solid var(--border); border-radius:12px 12px 0 0}
    .modal .content{padding:16px}
    .form{display:grid; grid-template-columns:1fr 1fr; gap:12px}
    .form .full{grid-column:1/-1}
    label{font-size:12px; color:var(--text-1)}
    input,select{
      width:100%; padding:10px; border-radius:10px; background:#0c1118; color:var(--text-0); border:1px solid var(--border);
      font-family:var(--sans);
    }

    /* Responsive */
    @media (max-width: 880px){
      .app{grid-template-columns:1fr; grid-template-rows:auto auto 1fr; grid-template-areas:"topbar" "sidebar" "main"}
      aside{flex-direction:row; overflow:auto; border-right:none; border-bottom:1px solid var(--border)}
      nav{flex-direction:row; flex-wrap:wrap}
      .nav-section{margin-top:0; margin-left:auto; border-top:none; border-left:1px dashed var(--border); padding-left:12px}
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- SIDEBAR -->
    <aside>
      <div class="brand">
        <svg width="28" height="28" viewBox="0 0 64 64" aria-hidden="true">
          <circle cx="32" cy="32" r="30" fill="#1f2632" />
          <circle cx="32" cy="22" r="10" fill="#6aa2ff"/>
          <rect x="22" y="34" width="20" height="12" rx="6" fill="#2e6bff"/>
        </svg>
        <strong>Hoops Mini GM</strong>
      </div>
      <nav id="nav">
        <button class="nav-btn active" data-view="dashboard">üè† Dashboard</button>
        <button class="nav-btn" data-view="roster">üßæ Roster</button>
        <button class="nav-btn" data-view="cap">üí∞ Cap Sheet</button>
        <button class="nav-btn" data-view="trades">üîÅ Trades</button>
        <button class="nav-btn" data-view="draft">üß¢ Draft</button>
      </nav>
      <div class="nav-section">
        <button class="nav-btn" data-view="settings">‚öôÔ∏è Settings</button>
      </div>
    </aside>

    <!-- TOPBAR -->
    <header>
      <div class="title">San Francisco Riptide</div>
      <span class="tag" id="seasonTag">Season: 2026</span>
      <span class="tag">Mode: <strong style="color:var(--text-0)">Sandbox</strong></span>
      <div class="spacer"></div>
      <button class="btn ghost" id="simDayBtn">Sim Day ‚ñ∂</button>
      <button class="btn good" id="saveBtn">Save</button>
      <button class="btn warn" id="resetBtn">Reset</button>
    </header>

    <!-- MAIN -->
    <main id="viewRoot">
      <!-- DASHBOARD -->
      <section class="panel" data-view="dashboard">
        <h2>Team Overview</h2>
        <div class="row">
          <div class="col">
            <div class="panel" style="padding:12px">
              <div class="capbar">
                <div class="bar" aria-label="Payroll vs Cap"><div class="fill" id="capFill"></div></div>
                <div class="kpi" id="capKpi">$0 / $0</div>
              </div>
              <div style="margin-top:8px; display:flex; gap:10px; flex-wrap:wrap">
                <span class="pill" id="spacePill">Cap Space: $0</span>
                <span class="pill" id="taxPill">Tax Room: $0</span>
                <span class="pill" id="apronPill">Apron Room: $0</span>
              </div>
            </div>
            <div class="toolbar">
              <button class="btn" data-view-jump="roster">Open Roster</button>
              <button class="btn" data-view-jump="cap">Open Cap Sheet</button>
              <button class="btn" data-view-jump="trades">Open Trades</button>
            </div>
          </div>
          <div class="col">
            <div class="panel" style="padding:12px">
              <div style="display:flex; justify-content:space-between; align-items:center">
                <strong>Recent Activity</strong><span class="tag">Media ‚Ä¢ Morale ‚Ä¢ Injuries</span>
              </div>
              <div id="feed" class="empty">No events yet. Your beat writer is doomscrolling.</div>
            </div>
          </div>
        </div>
      </section>

      <!-- ROSTER -->
      <section class="panel" data-view="roster" hidden>
        <h2>Roster</h2>
        <div class="toolbar">
          <button class="btn good" id="addPlayerBtn">Add Player</button>
          <button class="btn ghost" id="sortOVR">Sort by OVR</button>
          <span class="tag" id="rosterCount">0/15</span>
        </div>
        <div class="table-wrap">
          <table id="rosterTable" aria-label="Roster table">
            <thead>
              <tr>
                <th data-sort="name">Player</th>
                <th data-sort="pos">Pos</th>
                <th class="num" data-sort="age">Age</th>
                <th class="num" data-sort="ovr">OVR</th>
                <th class="num" data-sort="salary">Salary</th>
                <th class="num" data-sort="years">Years</th>
                <th class="num">Actions</th>
              </tr>
            </thead>
            <tbody id="rosterBody">
              <tr><td colspan="7" class="empty">Add players to begin your dynasty.</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- CAP SHEET -->
      <section class="panel" data-view="cap" hidden>
        <h2>Cap Sheet</h2>
        <div class="toolbar">
          <span class="tag">Cap: <span id="capNum">$0</span></span>
          <span class="tag">Tax Line: <span id="taxNum">$0</span></span>
          <span class="tag">First Apron: <span id="apron1Num">$0</span></span>
          <span class="tag">Second Apron: <span id="apron2Num">$0</span></span>
        </div>
        <div class="table-wrap">
          <table id="capTable">
            <thead>
              <tr>
                <th>Player</th><th class="num">2026</th><th class="num">2027</th><th class="num">2028</th><th class="num">Options</th>
              </tr>
            </thead>
            <tbody id="capBody"></tbody>
          </table>
        </div>
      </section>

      <!-- TRADES -->
      <section class="panel" data-view="trades" hidden>
        <h2>Trade Center</h2>
        <div class="toolbar">
          <button class="btn" id="tradeIdea">Generate Trade Idea</button>
          <span class="tag">Prototype</span>
        </div>
        <div id="tradeArea" class="empty">Trade engine not wired yet. This is where pick protections, matching rules, and AI team preferences will live.</div>
      </section>

      <!-- DRAFT -->
      <section class="panel" data-view="draft" hidden>
        <h2>Draft Room</h2>
        <div class="toolbar">
          <button class="btn" id="genProspects">Generate Prospects</button>
          <span class="tag">Big Board v0.1</span>
        </div>
        <div id="draftArea" class="empty">Prospects will appear here with fog-of-war scouting grades.</div>
      </section>

      <!-- SETTINGS -->
      <section class="panel" data-view="settings" hidden>
        <h2>Settings</h2>
        <div class="row">
          <div class="col">
            <label>Team Name</label>
            <input id="teamName" value="San Francisco Riptide" />
          </div>
          <div class="col">
            <label>Season</label>
            <input id="seasonInput" type="number" value="2026" />
          </div>
        </div>
        <div class="toolbar" style="margin-top:12px">
          <button class="btn good" id="applySettings">Apply</button>
        </div>
      </section>
    </main>
  </div>

  <!-- ADD PLAYER MODAL -->
  <div class="modal-backdrop" id="modal">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="addPlayerTitle">
      <header>
        <div class="title" id="addPlayerTitle">Add Player</div>
        <div class="spacer"></div>
        <button class="btn ghost" id="closeModal">Close</button>
      </header>
      <div class="content">
        <div class="form">
          <div>
            <label>Name</label>
            <input id="pName" placeholder="e.g., J. Rivera" />
          </div>
          <div>
            <label>Position</label>
            <select id="pPos">
              <option>PG</option><option>SG</option><option>SF</option><option>PF</option><option>C</option>
            </select>
          </div>
          <div>
            <label>Age</label>
            <input id="pAge" type="number" min="18" max="45" value="24" />
          </div>
          <div>
            <label>OVR</label>
            <input id="pOvr" type="number" min="40" max="99" value="76" />
          </div>
          <div>
            <label>Salary (2026)</label>
            <input id="pSalary" type="number" min="0" step="100000" value="8200000" />
          </div>
          <div>
            <label>Years</label>
            <input id="pYears" type="number" min="1" max="5" value="2" />
          </div>
          <div class="full">
            <label>Notes</label>
            <input id="pNotes" placeholder="e.g., 3&D wing, team option Yr2" />
          </div>
        </div>
        <div class="toolbar" style="margin-top:12px">
          <button class="btn good" id="submitPlayer">Add to Roster</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // -------------------------------
    // Minimal data model (expandable)
    // -------------------------------
    const DEFAULT_RULES = {
      cap: 149_000_000,     // 2026 example cap
      tax: 181_000_000,     // tax threshold
      apron1: 189_000_000,  // first apron
      apron2: 199_000_000,  // second apron
      rosterLimit: 15
    };

    const initialState = {
      meta: { teamName: "San Francisco Riptide", season: 2026, rules: DEFAULT_RULES },
      roster: [
        {id: uid(), name:"D. Lawson", pos:"PG", age:27, ovr:84, salary:24_500_000, years:3, notes:"Primary ball-handler"},
        {id: uid(), name:"K. Ajayi", pos:"SG", age:24, ovr:82, salary:18_200_000, years:2, notes:"Slasher, plus defender"},
        {id: uid(), name:"M. Petrovic", pos:"C",  age:29, ovr:80, salary:16_000_000, years:2, notes:"Drop big, elite screener"},
        {id: uid(), name:"R. Vega", pos:"SF", age:22, ovr:76, salary:8_200_000, years:2, notes:"3&D, team opt Yr2"},
        {id: uid(), name:"T. Han", pos:"PF", age:31, ovr:74, salary:5_100_000, years:1, notes:"Vet floor spacer"}
      ],
      events: [
        {ts: Date.now(), text:"Hired analytics intern who speaks exclusively in effective field goal percentage."}
      ],
      prospects: []
    };

    // -------------------------------
    // Storage
    // -------------------------------
    const STORAGE_KEY = "hoops-mini-gm";
    function load(){
      try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || initialState }
      catch { return initialState }
    }
    function save(state){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
      toast("Saved league.");
    }

    // -------------------------------
    // Utilities
    // -------------------------------
    function uid(){ return Math.random().toString(36).slice(2,9) }
    const fmt = (n) => "$" + Math.round(n).toLocaleString();
    function sum(a, f){ return a.reduce((t,x)=>t+f(x),0) }
    function by(key, dir=1){ return (a,b)=> (a[key]>b[key]?1:-1)*dir }
    function clamp(n, min, max){ return Math.max(min, Math.min(max, n)) }

    // -------------------------------
    // State (live)
    // -------------------------------
    let STATE = load();

    // -------------------------------
    // DOM helpers
    // -------------------------------
    const $ = (q, root=document)=>root.querySelector(q);
    const $$ = (q, root=document)=>Array.from(root.querySelectorAll(q));

    // -------------------------------
    // Navigation
    // -------------------------------
    $$("#nav .nav-btn").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const view = btn.dataset.view;
        $$("#nav .nav-btn").forEach(b=>b.classList.toggle("active", b===btn));
        $$("main section.panel").forEach(sec=>{
          sec.hidden = (sec.dataset.view !== view);
        });
        if(view === "roster") renderRoster();
        if(view === "cap") renderCapSheet();
      });
    });
    $$("[data-view-jump]").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const target = btn.getAttribute("data-view-jump");
        $(`#nav .nav-btn[data-view="${target}"]`).click();
      });
    });

    // -------------------------------
    // Topbar actions
    // -------------------------------
    $("#saveBtn").addEventListener("click", ()=> save(STATE));
    $("#resetBtn").addEventListener("click", ()=>{
      if(confirm("Reset league to defaults?")){ STATE = structuredClone(initialState); rerenderAll(); toast("League reset."); }
    });
    $("#simDayBtn").addEventListener("click", ()=>{
      const ev = {ts: Date.now(), text:"You advanced a day. Rival GM leaked a cryptic tweet with a cap calculator emoji."};
      STATE.events.unshift(ev);
      renderFeed();
    });

    // -------------------------------
    // Settings
    // -------------------------------
    $("#applySettings").addEventListener("click", ()=>{
      STATE.meta.teamName = $("#teamName").value.trim() || "My Team";
      STATE.meta.season = Number($("#seasonInput").value) || STATE.meta.season;
      $(".title").textContent = STATE.meta.teamName;
      $("#seasonTag").textContent = `Season: ${STATE.meta.season}`;
      toast("Settings applied.");
    });

    // -------------------------------
    // Dashboard
    // -------------------------------
    function renderDashboardCaps(){
      const {cap,tax,apron1,apron2} = STATE.meta.rules;
      const payroll = sum(STATE.roster, p=>p.salary);
      const pct = clamp((payroll/cap)*100,0,100);
      $("#capFill").style.width = pct.toFixed(1)+"%";
      $("#capKpi").textContent = `${fmt(payroll)} / ${fmt(cap)}`;
      $("#spacePill").textContent = `Cap Space: ${fmt(cap - payroll)}`;
      $("#taxPill").textContent = `Tax Room: ${fmt(tax - payroll)}`;
      $("#apronPill").textContent = `Apron Room: ${fmt(apron1 - payroll)} (A1) ‚Ä¢ ${fmt(apron2 - payroll)} (A2)`;
    }
    function renderFeed(){
      const feed = $("#feed");
      if(!STATE.events.length){ feed.className="empty"; feed.textContent="No events yet. Your beat writer is doomscrolling."; return; }
      feed.className="";
      feed.innerHTML = STATE.events.slice(0,6).map(e=>{
        const d = new Date(e.ts).toLocaleString();
        return `<div style="padding:8px 0; border-bottom:1px dashed var(--border)"><span class="tag" style="margin-right:8px">${d}</span>${e.text}</div>`;
      }).join("");
    }

    // -------------------------------
    // Roster
    // -------------------------------
    let currentSort = {key:"ovr", dir:-1};
    $("#sortOVR").addEventListener("click", ()=>{
      currentSort = {key:"ovr", dir:-1};
      renderRoster();
    });
    $$("#rosterTable thead th[data-sort]").forEach(th=>{
      th.addEventListener("click", ()=>{
        const key = th.dataset.sort;
        if(currentSort.key===key){ currentSort.dir *= -1 } else { currentSort = {key, dir: key==="name"||key==="pos"?1:-1}; }
        renderRoster();
      });
    });

    function renderRoster(){
      const tbody = $("#rosterBody");
      const roster = [...STATE.roster].sort(by(currentSort.key, currentSort.dir));
      $("#rosterCount").textContent = `${roster.length}/${STATE.meta.rules.rosterLimit}`;
      if(!roster.length){ tbody.innerHTML = `<tr><td colspan="7" class="empty">Add players to begin your dynasty.</td></tr>`; return; }
      tbody.innerHTML = roster.map(p=>`
        <tr>
          <td><strong>${escapeHtml(p.name)}</strong><div class="tag" style="margin-top:4px">${escapeHtml(p.notes||"")}</div></td>
          <td class="pos">${p.pos}</td>
          <td class="num">${p.age}</td>
          <td class="num ovr">${p.ovr}</td>
          <td class="num">${fmt(p.salary)}</td>
          <td class="num">${p.years}</td>
          <td class="num">
            <button class="btn ghost" data-act="bump" data-id="${p.id}" title="Increase OVR">‚ñ≤</button>
            <button class="btn ghost" data-act="drop" data-id="${p.id}" title="Decrease OVR">‚ñº</button>
            <button class="btn bad" data-act="waive" data-id="${p.id}" title="Remove">Waive</button>
          </td>
        </tr>
      `).join("");
      // actions
      $("#rosterBody").querySelectorAll("[data-act]").forEach(b=>{
        b.addEventListener("click", ()=>{
          const id = b.dataset.id;
          const p = STATE.roster.find(x=>x.id===id);
          if(!p) return;
          if(b.dataset.act==="waive"){
            if(confirm(`Waive ${p.name}?`)){ STATE.roster = STATE.roster.filter(x=>x.id!==id); addEvent(`${p.name} was waived.`); rerenderAll(); }
          }
          if(b.dataset.act==="bump"){ p.ovr = Math.min(99, p.ovr+1); renderRoster(); }
          if(b.dataset.act==="drop"){ p.ovr = Math.max(40, p.ovr-1); renderRoster(); }
          renderDashboardCaps();
          renderCapSheet();
        });
      });
      renderDashboardCaps();
      renderCapSheet();
    }

    // Add Player Modal
    const modal = $("#modal");
    $("#addPlayerBtn").addEventListener("click", ()=> modal.style.display="flex");
    $("#closeModal").addEventListener("click", ()=> modal.style.display="none");
    $("#submitPlayer").addEventListener("click", ()=>{
      const name = $("#pName").value.trim();
      if(!name){ alert("Name required."); return; }
      const pos = $("#pPos").value;
      const age = Number($("#pAge").value)||24;
      const ovr = Number($("#pOvr").value)||70;
      const salary = Number($("#pSalary").value)||0;
      const years = Number($("#pYears").value)||1;
      const notes = $("#pNotes").value.trim();
      STATE.roster.push({id:uid(), name, pos, age, ovr, salary, years, notes});
      addEvent(`${name} signed a ${years}-yr deal for ${fmt(salary)}.`);
      modal.style.display="none";
      clearModalInputs();
      rerenderAll();
    });
    function clearModalInputs(){
      ["pName","pAge","pOvr","pSalary","pYears","pNotes"].forEach(id=>{ const el = $("#"+id); if(el) el.value = el.type==="number" ? el.value : "" });
    }

    // -------------------------------
    // Cap Sheet
    // -------------------------------
    function renderCapSheet(){
      const {cap,tax,apron1,apron2} = STATE.meta.rules;
      $("#capNum").textContent = fmt(cap);
      $("#taxNum").textContent = fmt(tax);
      $("#apron1Num").textContent = fmt(apron1);
      $("#apron2Num").textContent = fmt(apron2);

      const body = $("#capBody");
      if(!STATE.roster.length){ body.innerHTML = `<tr><td colspan="5" class="empty">No contracts on the books.</td></tr>`; return; }
      body.innerHTML = STATE.roster.map(p=>{
        const y1 = p.salary;
        const y2 = Math.round(p.years>=2 ? p.salary*1.05 : 0);
        const y3 = Math.round(p.years>=3 ? y2*1.05 : 0);
        const opt = /opt|option/i.test(p.notes||"") ? "Team Opt" : "";
        return `<tr>
          <td>${escapeHtml(p.name)}</td>
          <td class="num">${y1?fmt(y1):"-"}</td>
          <td class="num">${y2?fmt(y2):"-"}</td>
          <td class="num">${y3?fmt(y3):"-"}</td>
          <td class="num">${opt||"-"}</td>
        </tr>`;
      }).join("");
    }

    // -------------------------------
    // Trades (stub) & Draft (stub)
    // -------------------------------
    $("#tradeIdea").addEventListener("click", ()=>{
      const need = inferTeamNeed();
      $("#tradeArea").className="";
      $("#tradeArea").innerHTML = `
        <div style="padding:8px 0">
          <strong>Idea:</strong> Package your ${need} + 2028 1st (top-10 protected) for a higher-OVR wing on an expiring. This keeps future cap space flexible while addressing your rotation.
        </div>
        <div class="tag">Prototype logic ‚Äî to be replaced with real matching & AI preferences.</div>
      `;
    });

    $("#genProspects").addEventListener("click", ()=>{
      STATE.prospects = Array.from({length:10}).map((_,i)=>({
        id:uid(),
        name: genName(),
        pos: ["PG","SG","SF","PF","C"][Math.floor(Math.random()*5)],
        age: 19,
        ovr: 65 + Math.floor(Math.random()*20),
        scouted: ["B-","B","B+","A-","A"][Math.floor(Math.random()*5)]
      }));
      $("#draftArea").className="";
      $("#draftArea").innerHTML = `
        <table style="width:100%">
          <thead><tr><th>Name</th><th>Pos</th><th class="num">OVR (foggy)</th><th class="num">Scout Grade</th></tr></thead>
          <tbody>
            ${STATE.prospects.map(p=>`<tr><td>${escapeHtml(p.name)}</td><td>${p.pos}</td><td class="num">${p.ovr}</td><td class="num">${p.scouted}</td></tr>`).join("")}
          </tbody>
        </table>
      `;
    });

    // -------------------------------
    // Helpers
    // -------------------------------
    function rerenderAll(){
      $(".title").textContent = STATE.meta.teamName;
      $("#seasonTag").textContent = `Season: ${STATE.meta.season}`;
      renderDashboardCaps();
      renderFeed();
      renderRoster();
      renderCapSheet();
    }
    function addEvent(text){ STATE.events.unshift({ts:Date.now(), text}); }
    function toast(msg){
      const el = document.createElement("div");
      el.textContent = msg;
      el.style.position="fixed"; el.style.bottom="16px"; el.style.right="16px";
      el.style.background="var(--bg-3)"; el.style.color="var(--text-0)";
      el.style.border="1px solid var(--border)"; el.style.padding="10px 12px";
      el.style.borderRadius="8px"; el.style.boxShadow="var(--shadow)"; el.style.zIndex=9999;
      document.body.appendChild(el);
      setTimeout(()=>el.remove(), 1800);
    }
    function escapeHtml(s){ return (s||"").replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])) }
    function inferTeamNeed(){
      // naive: find lowest OVR position
      const byPos = {};
      for(const p of STATE.roster){ byPos[p.pos] = Math.max(byPos[p.pos]||0, p.ovr); }
      const order = ["PG","SG","SF","PF","C"].map(pos=>({pos,ovr:byPos[pos]||0})).sort((a,b)=>a.ovr-b.ovr);
      return order[0]?.pos || "wing";
    }
    function genName(){
      const first=["Jalen","Maya","Kei","Rico","Devon","Luka","Tiana","Anya","Jude","Zion","Niko","Rhea","Kobe","Imani","Kai"];
      const last=["Lawson","Ajayi","Vega","Petrovic","Nguyen","Rodriguez","Okafor","Han","Silva","Rossi","Dubois","Khan","Ivanov","Yamamoto","O'Neal"];
      return first[Math.floor(Math.random()*first.length)]+" "+last[Math.floor(Math.random()*last.length)];
    }

    // Init
    rerenderAll();
  </script>
</body>
</html>
